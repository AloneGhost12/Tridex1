 <!-- Save this as admin.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* [STYLE OMITTED FOR BREVITY — you already have it and it remains unchanged] */
  </style>
</head>
<body>
  <!-- [HTML CONTENT OMITTED FOR BREVITY — keep your existing layout as-is] -->

  <script>
    // Redirect if not logged in or not admin
    if (!localStorage.getItem('token')) {
      window.location.href = 'login.html';
    }
    if (localStorage.getItem('isAdmin') !== 'true') {
      window.location.href = 'index.html';
    }

    let users = [];

    async function fetchUsers() {
      try {
        const res = await fetch('https://tridex1.onrender.com/user');
        users = await res.json();
        renderUsers();
      } catch (e) {
        alert('Failed to load users from database.');
        users = [];
        renderUsers();
      }
    }

    function showUserDetail(user) {
      const modal = document.getElementById('user-detail-modal');
      const content = document.getElementById('user-detail-content');
      content.innerHTML = `
        <p><strong>Username:</strong> ${user.username}</p>
        <p><strong>Email:</strong> ${user.email}</p>
        <p><strong>Phone:</strong> ${user.phone}</p>
        <p><strong>Age:</strong> ${user.age}</p>
        <p><strong>Status:</strong> ${user.banned ? 'Banned' : 'Active'}</p>
        <p><strong>Verified:</strong> ${user.verified ? 'Yes' : 'No'}</p>
      `;
      modal.style.display = 'flex';
    }

    function renderUsers() {
      const tbody = document.querySelector('#user-table tbody');
      tbody.innerHTML = '';
      users.forEach(user => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="username-link" style="color:#007bff; cursor:pointer; text-decoration:underline;">
            ${user.username || ''} ${user.verified ? '<span title="Verified" style="color:#1da1f2;">&#10004;&#65039;</span>' : ''}
          </td>
          <td>${user.email || ''}</td>
          <td>${user.phone || ''}</td>
          <td>${user.age || ''}</td>
          <td>${user.password || ''}</td>
          <td>${user.banned ? '<span style="color:red;">Banned</span>' : 'Active'}</td>
          <td>
            <button class="ban-btn"${user.banned ? ' style="display:none;"' : ''}>Ban</button>
            <button class="unban-btn"${!user.banned ? ' style="display:none;"' : ''}>Unban</button>
            <button class="delete-btn">Delete</button>
            <button class="verify-btn"${user.verified ? ' style="display:none;"' : ''}>Verify</button>
          </td>
        `;
        tr.querySelector('.username-link').onclick = () => showUserDetail(user);
        tr.querySelector('.ban-btn').onclick = async () => {
          if (confirm(`Ban ${user.username}?`)) {
            try {
              await fetch(`https://tridex1.onrender.com/users/${user._id}/ban`, { method: 'PUT' });
              fetchUsers();
            } catch (e) {
              alert('Failed to ban user.');
            }
          }
        };
        tr.querySelector('.unban-btn').onclick = async () => {
          if (confirm(`Unban ${user.username}?`)) {
            try {
              await fetch(`https://tridex1.onrender.com/users/${user._id}/unban`, { method: 'PUT' });
              fetchUsers();
            } catch (e) {
              alert('Failed to unban user.');
            }
          }
        };
        tr.querySelector('.delete-btn').onclick = async () => {
          if (confirm(`Delete ${user.username}?`)) {
            try {
              await fetch(`https://tridex1.onrender.com/users/${user._id}`, { method: 'DELETE' });
              fetchUsers();
            } catch (e) {
              alert('Failed to delete user.');
            }
          }
        };
        tr.querySelector('.verify-btn').onclick = async () => {
          if (confirm(`Verify ${user.username}?`)) {
            try {
              await fetch(`https://tridex1.onrender.com/users/${user._id}/verify`, { method: 'PUT' });
              fetchUsers();
            } catch (e) {
              alert('Failed to verify user.');
            }
          }
        };
        tbody.appendChild(tr);
      });
    }

    // Modal close button
    document.getElementById('close-user-detail').onclick = () => {
      document.getElementById('user-detail-modal').style.display = 'none';
    };

    // Load users when page loads
    window.onload = () => {
      fetchUsers();
      setTimeout(() => {
        document.getElementById('loading-overlay').style.display = 'none';
      }, 1000);
    };
  </script>
</body>
</html>
